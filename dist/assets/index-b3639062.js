import{r as y,d as Q,u as V,l as d,v as X,j as g,a as o,F as p,T as m,S as A,G as S,I as ee,f as re,g as oe,B as w,t as se}from"./index-031fa283.js";import{d as ae,M as te,C as ne,a as ie,I as le,b as ce,S as de}from"./index-d87e9139.js";import{B as ue}from"./index.esm-c48e3429.js";import{M as he,a as me,b as ge,c as fe,H as pe}from"./index.esm-65c92dff.js";import{C as F}from"./Card-06514448.js";import{P as T}from"./Popover-411edea3.js";import"./get-default-z-index-b47c3510.js";import"./CloseButton-eab6b835.js";import"./use-reduced-motion-017d389a.js";import"./index.esm-2ae87725.js";function De({allStates:j,allActions:z,allDispatches:O}){const[_,H]=y.useState([]),[n,k]=y.useState([]),[N,M]=y.useState(!1),[P,U]=y.useState(""),[Y,G]=y.useState(""),{width:l=0}=Q();V();let{responseState:{fetchUrl:D,startIndex:b,searchTerm:v,searchResults:L,selectedVolume:I,selectedAuthor:B,selectedPublisher:E,bookshelfVolumes:C},navlinksState:W,themeState:{theme:f}}=j,{navlinksActions:Z}=z,{responseDispatch:$,navlinksDispatch:q}=O;const R=C??_.map(a=>a.volume),J={navlinksState:W,navlinksActions:Z,navlinksDispatch:q};async function x(a,t,h,c){const s=structuredClone(h);switch(a){case"rating":{const i=s.find(e=>e.id===t.id),u=s.findIndex(e=>e.id===t.id);if(i){i.rating=c,s.splice(u,1,i),k(s);try{await d.setItem("byblos-userBookshelf",s)}catch(e){const r=new Error(e,{cause:"switch case 'rating', in if block"});console.group("Error in setting userBookshelf in displayBookshelf: switch case 'rating', in localforage"),console.error("name: ",r.name),console.error("message: ",r.message),console.error("cause: ",r.cause),console.groupCollapsed("stack trace"),console.trace(r),console.error("detailed stack trace",r.stack),console.groupEnd()}}else{s.push({name:t.volumeInfo.title,id:t.id,volume:t,rating:c,markRead:!1,favourite:!1,readLater:!1,dateAdded:new Date}),k(s);try{await d.setItem("byblos-userBookshelf",s)}catch(e){const r=new Error(e,{cause:"switch case 'rating', in else block"});console.group("Error in setting userBookshelf in displayBookshelf: switch case 'rating', in localforage"),console.error("name: ",r.name),console.error("message: ",r.message),console.error("cause: ",r.cause),console.groupCollapsed("stack trace"),console.trace(r),console.error("detailed stack trace",r.stack),console.groupEnd()}}break}case"markRead":{const i=s.find(e=>e.id===t.id),u=s.findIndex(e=>e.id===t.id);if(i){i.markRead=!c,s.splice(u,1,i),k(s);try{await d.setItem("byblos-userBookshelf",s)}catch(e){const r=new Error(e,{cause:"switch case 'markRead', in if block"});console.group("Error in setting userBookshelf in displayBookshelf: switch case 'markRead', in localforage"),console.error("name: ",r.name),console.error("message: ",r.message),console.error("cause: ",r.cause),console.groupCollapsed("stack trace"),console.trace(r),console.error("detailed stack trace",r.stack),console.groupEnd()}}else{s.push({name:t.volumeInfo.title,id:t.id,volume:t,rating:0,markRead:!c,favourite:!1,readLater:!1,dateAdded:new Date}),k(s);try{await d.setItem("byblos-userBookshelf",s)}catch(e){const r=new Error(e,{cause:"switch case 'markRead', in else block"});console.group("Error in setting userBookshelf in displayBookshelf: switch case 'markRead', in localforage"),console.error("name: ",r.name),console.error("message: ",r.message),console.error("cause: ",r.cause),console.groupCollapsed("stack trace"),console.trace(r),console.error("detailed stack trace",r.stack),console.groupEnd()}}break}case"favourite":{const i=s.find(e=>e.id===t.id),u=s.findIndex(e=>e.id===t.id);if(i){i.favourite=!c,s.splice(u,1,i),k(s);try{await d.setItem("byblos-userBookshelf",s)}catch(e){const r=new Error(e,{cause:"switch case 'favourite', in if block"});console.group("Error in setting userBookshelf in displayBookshelf: switch case 'favourite', in localforage"),console.error("name: ",r.name),console.error("message: ",r.message),console.error("cause: ",r.cause),console.groupCollapsed("stack trace"),console.trace(r),console.error("detailed stack trace",r.stack),console.groupEnd()}}else{s.push({name:t.volumeInfo.title,id:t.id,volume:t,rating:0,markRead:!1,favourite:!c,readLater:!1,dateAdded:new Date}),k(s);try{await d.setItem("byblos-userBookshelf",s)}catch(e){const r=new Error(e,{cause:"switch case 'favourite', in else block"});console.group("Error in setting userBookshelf in displayBookshelf: switch case 'favourite', in localforage"),console.error("name: ",r.name),console.error("message: ",r.message),console.error("cause: ",r.cause),console.groupCollapsed("stack trace"),console.trace(r),console.error("detailed stack trace",r.stack),console.groupEnd()}}break}case"readLater":{const i=s.find(e=>e.id===t.id),u=s.findIndex(e=>e.id===t.id);if(i){i.readLater=!c,s.splice(u,1,i),k(s);try{await d.setItem("byblos-userBookshelf",s)}catch(e){const r=new Error(e,{cause:"switch case 'readLater', in if block"});console.group("Error in setting userBookshelf in displayBookshelf: switch case 'readLater', in localforage"),console.error("name: ",r.name),console.error("message: ",r.message),console.error("cause: ",r.cause),console.groupCollapsed("stack trace"),console.trace(r),console.error("detailed stack trace",r.stack),console.groupEnd()}}else{s.push({name:t.volumeInfo.title,id:t.id,volume:t,rating:0,markRead:!1,favourite:!1,readLater:!c,dateAdded:new Date}),k(s);try{await d.setItem("byblos-userBookshelf",s)}catch(e){const r=new Error(e,{cause:"switch case 'readLater', in else block"});console.group("Error in setting userBookshelf in displayBookshelf: switch case 'readLater', in localforage"),console.error("name: ",r.name),console.error("message: ",r.message),console.error("cause: ",r.cause),console.groupCollapsed("stack trace"),console.trace(r),console.error("detailed stack trace",r.stack),console.groupEnd()}}break}case"removeVolume":{const i=s.find(e=>e.id===t.id),u=s.findIndex(e=>e.id===t.id);if(i){s.splice(u,1),k(s);try{await d.setItem("byblos-userBookshelf",s)}catch(e){const r=new Error(e,{cause:"switch case 'removeVolume', in if block"});console.group("Error in setting userBookshelf in displayBookshelf: switch case 'removeVolume', in localforage"),console.error("name: ",r.name),console.error("message: ",r.message),console.error("cause: ",r.cause),console.groupCollapsed("stack trace"),console.trace(r),console.error("detailed stack trace",r.stack),console.groupEnd()}}break}}}y.useEffect(()=>{(async()=>{try{const t=await d.getItem("byblos-userBookshelf");t&&H(t)}catch(t){const h=new Error(t,{cause:"fetchLocalStorageFallback()"});console.group("Error in displayBookshelf useEffect"),console.error("name: ",h.name),console.error("message: ",h.message),console.error("cause: ",h.cause),console.groupCollapsed("stack trace"),console.trace(h),console.error("detailed stack trace",h.stack),console.groupEnd()}})()},[]);async function K(a,t){var i;let{navlinksState:h,navlinksActions:c,navlinksDispatch:s}=t;se(h,c,s),b=0,v=a.volumeInfo.title,I=a,B=((i=a.volumeInfo.authors)==null?void 0:i.join(","))??"",E=a.volumeInfo.publisher??"";try{await d.setItem("byblos-startIndex",b),await d.setItem("byblos-searchTerm",v),await d.setItem("byblos-selectedVolume",I),await d.setItem("byblos-selectedAuthor",B),await d.setItem("byblos-selectedPublisher",E);const u=await d.getItem("byblos-historyState")??[{fetchUrl:D,startIndex:b,searchTerm:v,searchResults:L,selectedVolume:I,selectedAuthor:B,selectedPublisher:E,bookshelfVolumes:C}];u.push({fetchUrl:D,startIndex:b,searchTerm:v,searchResults:L,selectedVolume:I,selectedAuthor:B,selectedPublisher:E,bookshelfVolumes:C}),await d.setItem("byblos-historyState",u)}catch(u){const e=new Error(u,{cause:"handleTitleClick()"});console.group("Error in displayBookshelf useEffect"),console.error("name: ",e.name),console.error("message: ",e.message),console.error("cause: ",e.cause),console.groupCollapsed("stack trace"),console.trace(e),console.error("detailed stack trace",e.stack),console.groupEnd()}finally{$({type:z.responseActions.setAll,payload:{responseState:{fetchUrl:D,startIndex:b,searchTerm:v,searchResults:L,selectedVolume:I,selectedAuthor:B,selectedPublisher:E,bookshelfVolumes:C}}}),window.scrollTo(0,0)}}return y.useEffect(()=>{(async function(){let t=[];try{t=await d.getItem("byblos-userBookshelf").then(h=>h??[{name:"Mirror Dance",id:X(),volume:ae,rating:5,markRead:!0,favourite:!0,readLater:!0,dateAdded:new Date}])}catch(h){const c=new Error(h,{cause:"useEffect in displayGeneric"});console.group("Error in displayGeneric generateUserBookshelf()"),console.error("name: ",c.name),console.error("message: ",c.message),console.error("cause: ",c.cause),console.groupCollapsed("stack trace"),console.trace(c),console.error("detailed stack trace",c.stack),console.groupEnd()}return t})().then(a=>{k(a)})},[]),g(y.Fragment,{children:[o(te,{modalOpened:N,setModalOpened:M,src:P,alt:Y,"data-cy":"image-modal"}),g(p,{gap:"xl",direction:"column",children:[R.length<2?o(ne,{children:o(F,{shadow:"sm",p:"md",radius:"md",withBorder:!0,children:g(p,{direction:"column",align:"center",justify:"center",children:[o(m,{color:f==="light"?"dark.5":"gray.5",children:"There seems to be nothing here."}),o(A,{h:"md"}),o(m,{color:f==="light"?"brand.4":"brand.8",size:28,children:"(｡•́︿•̀｡)"})]})})}):null,R.map(a=>{var t,h,c,s,i,u;return a.id==="aZ0YkIU0HusC"?null:o(F,{shadow:"sm",p:l<576?"xs":"md",radius:"md",withBorder:!0,style:{minHeight:"325px"},children:g(S,{columns:9,children:[o(S.Col,{span:l<992?2:1,children:o(p,{style:{width:"100%",height:"100%",minWidth:"50px"},direction:"column",justify:"center",align:"center",children:o(ee,{style:{cursor:"pointer"},src:(t=a.volumeInfo.imageLinks)==null?void 0:t.thumbnail,alt:"",onClick:()=>{var e;U(((e=a.volumeInfo.imageLinks)==null?void 0:e.thumbnail)??""),G(a.volumeInfo.title),M(!0)},withPlaceholder:!0,placeholder:o(m,{align:"center",children:"No image available"}),radius:"xs","data-cy":"image-thumbnail"})})}),g(S.Col,{span:l<992?7:8,children:[g(p,{align:"center",justify:"space-between",children:[o(re,{order:3,onClick:()=>{K(a,J)},"data-cy":"title-volume",style:{paddingBottom:"3px"},color:f==="light"?"dark.5":"gray.4",children:o(oe,{to:`/home/displayVolume/${a.customId}`,style:{textDecoration:"none",color:"inherit"},children:a.volumeInfo.title})}),o(p,{children:g(T,{width:300,position:l<576?"bottom":"left",withArrow:!0,shadow:"xl",radius:"md",children:[o(T.Target,{children:o(w,{variant:l<576?"light":"subtle",radius:"lg","data-cy":"dropdownIcon-volume",children:o(ue,{size:20})})}),o(T.Dropdown,{children:g(p,{direction:"column",justify:"center",align:"center",gap:"sm","data-cy":"dropdownMenu-volume",children:[g(p,{direction:"row",align:"center",justify:"space-between",style:{width:"100%"},children:[o(m,{size:l<576?"sm":"md",color:f==="light"?"dark.5":"gray.5","data-cy":"rate-dropDownMenu",children:"Rate"}),o(ie,{value:((h=n==null?void 0:n.find(e=>e.id===a.id))==null?void 0:h.rating)??0,onChange:e=>x("rating",a,n,e)})]}),g(p,{direction:"row",align:"center",justify:"space-between",style:{width:"100%"},children:[o(m,{size:l<576?"sm":"md",color:f==="light"?"dark.5":"gray.5","data-cy":"favourite-dropDownMenu",children:"Favourite"}),o(w,{variant:l<576?"light":"subtle",radius:"lg",onClick:()=>{var e;x("favourite",a,n,((e=n.find(r=>r.id===a.id))==null?void 0:e.favourite)??!1)},children:(c=n==null?void 0:n.find(e=>e.id===a.id))!=null&&c.favourite?o(he,{size:20}):o(me,{size:20})})]}),g(p,{direction:"row",align:"center",justify:"space-between",style:{width:"100%"},children:[o(m,{size:l<576?"sm":"md",color:f==="light"?"dark.5":"gray.5","data-cy":"readLater-dropDownMenu",children:"Read later"}),o(w,{variant:l<576?"light":"subtle",radius:"lg",onClick:()=>{var e;x("readLater",a,n,((e=n.find(r=>r.id===a.id))==null?void 0:e.readLater)??!1)},children:(s=n==null?void 0:n.find(e=>e.id===a.id))!=null&&s.readLater?o(ge,{size:20}):o(fe,{size:20})})]}),g(p,{direction:"row",align:"center",justify:"space-between",style:{width:"100%"},children:[o(m,{size:l<576?"sm":"md",color:f==="light"?"dark.5":"gray.5","data-cy":"markRead-dropDownMenu",children:"Mark read"}),o(w,{variant:l<576?"light":"subtle",radius:"lg",onClick:()=>{var e;x("markRead",a,n,((e=n.find(r=>r.id===a.id))==null?void 0:e.markRead)??!1)},children:(i=n==null?void 0:n.find(e=>e.id===a.id))!=null&&i.markRead?o(le,{size:20}):o(ce,{size:20})})]}),g(p,{direction:"row",align:"center",justify:"space-between",style:{width:"100%"},children:[o(m,{size:l<576?"sm":"md",color:f==="light"?"dark.5":"gray.5","data-cy":"remove-dropDownMenu",children:"Remove"}),o(w,{variant:l<576?"light":"subtle",radius:"lg",disabled:!(n!=null&&n.some(e=>e.id===a.id)),onClick:()=>{x("removeVolume",a,n,!0)},children:o(pe,{size:20})})]})]})})]})})]}),(u=a.volumeInfo.authors)==null?void 0:u.join(",:").split(":").map(e=>g(m,{style:{display:"inline"},color:f==="light"?"dark.5":"gray.4","data-cy":"author-volume",size:l<576?"lg":"md",children:[e," "]},e)),o(m,{style:{paddingTop:"3px",paddingBottom:"3px"},color:f==="light"?"dark.5":"gray.5","data-cy":"publishedYear-volume",size:"md",children:Number.isNaN(new Date(a.volumeInfo.publishedDate).getFullYear().toString())||new Date(a.volumeInfo.publishedDate).getFullYear().toString()==="NaN"?"Date unavailable":new Date(a.volumeInfo.publishedDate).getFullYear()}),o(de,{maxHeight:l<576?174:178,"data-cy":"spoiler-volume",showLabel:l<576?o(w,{radius:"md",variant:"light",children:o(m,{size:l<576?"sm":"md",children:"⬇ Show more"})}):o(m,{size:l<576?"sm":"md",weight:"bold",children:"⬇ Show more"}),hideLabel:l<576?o(w,{radius:"md",variant:"light",children:o(m,{size:l<576?"sm":"md",children:"⬆ Hide"})}):o(m,{size:l<576?"sm":"md",weight:"bold",children:"⬆ Hide"}),transitionDuration:382,children:o(m,{color:f==="light"?"dark.5":"gray.5","data-cy":"description-volume",size:"md",children:a.volumeInfo.description??"Description unavailable"})})]})]},a.customId)},a.customId)})]}),o(A,{h:"xl"})]})}export{De as default};
