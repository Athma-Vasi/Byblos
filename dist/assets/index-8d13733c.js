import{r as h,u as W,j as F,a as s,F as B,e as G,S as U,E as L,b as z,M as H,c as _,i as J,l as n}from"./index-064c6a11.js";import{u as K}from"./react-intersection-observer.esm-299e8c76.js";import O from"./index-5d3916a2.js";import"./index.esm-008f09fb.js";import"./index.esm-6f373bf9.js";import"./index-63689533.js";import"./Popover-77682786.js";import"./use-reduced-motion-36c0a9c9.js";import"./get-default-z-index-b47c3510.js";import"./Card-5f2de60e.js";import"./CloseButton-a48066d3.js";import"./index.esm-348e47db.js";function ae({allStates:E,allActions:C,allDispatches:k}){const[w,M]=h.useState([]),[j,P]=h.useState(!0);W();const{ref:D,inView:x}=K({threshold:0});let{responseState:{fetchUrl:p,startIndex:d,searchTerm:u,searchResults:e,selectedVolume:a,selectedAuthor:g,selectedPublisher:A,bookshelfVolumes:S},themeState:{theme:N}}=E,{responseDispatch:T}=k,{responseActions:{setAll:$}}=C;return h.useEffect(()=>{(async()=>{try{const[l,o]=p.split("q="),b=`${l}q=+inauthor:${g||(a==null?void 0:a.volumeInfo.authors)||w[0].volumeInfo.authors||(e==null?void 0:e.items[0].volumeInfo.authors)||""}&maxResults=40${o}`,{data:i}=await _.get(b),r=J(i.items??[]);d=0,u=`+inauthor:${g||(a==null?void 0:a.volumeInfo.authors)||w[0].volumeInfo.authors||(e==null?void 0:e.items[0].volumeInfo.authors)||""}`,e=i;try{await n.setItem("byblos-startIndex",d),await n.setItem("byblos-searchTerm",u),await n.setItem("byblos-searchResults",e)}catch(I){const c=new Error(I,{cause:"inner try block inside fetchAuthorCollection()"});console.group("Error in authorCollection useEffect"),console.error("name: ",c.name),console.error("message: ",c.message),console.error("cause: ",c.cause),console.groupCollapsed("stack trace"),console.trace(c),console.error("detailed stack trace",c.stack),console.groupEnd()}finally{T({type:$,payload:{responseState:{fetchUrl:p,startIndex:d,searchTerm:u,searchResults:e,selectedVolume:a,selectedAuthor:g,selectedPublisher:A,bookshelfVolumes:S}}}),M(r)}}catch(l){const o=new Error(l,{cause:"outer try block inside fetchAuthorCollection()"});console.group("Error in authorCollection useEffect"),console.error("name: ",o.name),console.error("message: ",o.message),console.error("cause: ",o.cause),console.groupCollapsed("stack trace"),console.trace(o),console.error("detailed stack trace",o.stack),console.groupEnd()}})()},[]),h.useEffect(()=>{let y=!1;return x&&(async()=>{var b;const o=d+40;try{const i=u||await n.getItem("byblos-searchTerm")||await n.getItem("byblos-searchTerm").then(t=>{var f;return(f=t==null?void 0:t.at(-1))==null?void 0:f.searchTerm})||"",[r,I]=p.split("?q=")||await n.getItem("byblos-fetchUrl").then(t=>t==null?void 0:t.split("?q="))||await n.getItem("byblos-fetchUrl").then(t=>{var f,q;return(q=(f=t==null?void 0:t.at(-1))==null?void 0:f.fetchUrl)==null?void 0:q.split("?q=")})||"",c=`${r}?q=${u}&startIndex=${o}&maxResults=40${I}`,{data:m}=await _.get(c);y||(m.items&&((b=e==null?void 0:e.items)==null||b.push(...m==null?void 0:m.items),T({type:$,payload:{responseState:{fetchUrl:p,startIndex:o,searchTerm:i,searchResults:{...m,items:e==null?void 0:e.items},selectedVolume:a,selectedAuthor:g,selectedPublisher:A,bookshelfVolumes:S}}})),(o>600||!m.items)&&P(!1))}catch(i){const r=new Error(i,{cause:"fetchMoreResults()"});console.group("Error in authorCollection useEffect"),console.error("name: ",r.name),console.error("message: ",r.message),console.error("cause: ",r.cause),console.groupCollapsed("stack trace"),console.trace(r),console.error("detailed stack trace",r.stack),console.groupEnd()}})(),()=>{y=!0}},[x]),F(h.Fragment,{children:[s(B,{justify:"center",children:s(G,{order:3,color:N==="light"?"dark.5":"gray.5",children:"Author collection"})}),s(U,{h:"md"}),s(L,{fallback:s(z,{componentName:"Author Collection"}),children:F(h.Suspense,{fallback:s(H,{componentName:"Author Collection"}),children:[s(O,{allStates:E,allActions:C,allDispatches:k}),s("div",{ref:j?D:null}),Array.from({length:5}).map((y,l)=>s(U,{h:"xl"},l))]})})]})}export{ae as default};
