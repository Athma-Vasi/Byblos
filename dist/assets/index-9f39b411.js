import{r as h,u as B,j as E,F as k,a as t,L as G,S as x,T as M,f as H,E as J,b as K,M as O,c as D,i as Q,e as R,l as n}from"./index-031fa283.js";import{u as V}from"./react-intersection-observer.esm-274d9d73.js";import X from"./index-1e643e4a.js";import"./index.esm-c48e3429.js";import"./index.esm-65c92dff.js";import"./index-d87e9139.js";import"./Popover-411edea3.js";import"./use-reduced-motion-017d389a.js";import"./get-default-z-index-b47c3510.js";import"./Card-06514448.js";import"./CloseButton-eab6b835.js";import"./index.esm-2ae87725.js";function ie({allStates:C,allActions:w,allDispatches:A}){const[T,L]=h.useState([]),[S,P]=h.useState(!0);B();const{ref:N,inView:$}=V({threshold:0});let{responseState:{fetchUrl:p,startIndex:d,searchTerm:u,searchResults:e,selectedVolume:a,selectedAuthor:g,selectedPublisher:F,bookshelfVolumes:j},themeState:{theme:W}}=C,{responseDispatch:q}=A,{responseActions:{setAll:U}}=w;h.useEffect(()=>{(async()=>{try{const[l,r]=p.split("q="),b=`${l}q=+inauthor:${g||(a==null?void 0:a.volumeInfo.authors)||T[0].volumeInfo.authors||(e==null?void 0:e.items[0].volumeInfo.authors)||""}&maxResults=40${r}`,{data:i}=await D.get(b);let o=Q(i.items??[]);o=R(o),d=0,u=`+inauthor:${g||(a==null?void 0:a.volumeInfo.authors)||T[0].volumeInfo.authors||(e==null?void 0:e.items[0].volumeInfo.authors)||""}`,e=i;try{await n.setItem("byblos-startIndex",d),await n.setItem("byblos-searchTerm",u),await n.setItem("byblos-searchResults",e)}catch(I){const c=new Error(I,{cause:"inner try block inside fetchAuthorCollection()"});console.group("Error in authorCollection useEffect"),console.error("name: ",c.name),console.error("message: ",c.message),console.error("cause: ",c.cause),console.groupCollapsed("stack trace"),console.trace(c),console.error("detailed stack trace",c.stack),console.groupEnd()}finally{q({type:U,payload:{responseState:{fetchUrl:p,startIndex:d,searchTerm:u,searchResults:e,selectedVolume:a,selectedAuthor:g,selectedPublisher:F,bookshelfVolumes:j}}}),L(o)}}catch(l){const r=new Error(l,{cause:"outer try block inside fetchAuthorCollection()"});console.group("Error in authorCollection useEffect"),console.error("name: ",r.name),console.error("message: ",r.message),console.error("cause: ",r.cause),console.groupCollapsed("stack trace"),console.trace(r),console.error("detailed stack trace",r.stack),console.groupEnd()}})()},[]),h.useEffect(()=>{let y=!1;return $&&(async()=>{var b;const r=d+40;try{const i=u||await n.getItem("byblos-searchTerm")||await n.getItem("byblos-searchTerm").then(s=>{var f;return(f=s==null?void 0:s.at(-1))==null?void 0:f.searchTerm})||"",[o,I]=p.split("?q=")||await n.getItem("byblos-fetchUrl").then(s=>s==null?void 0:s.split("?q="))||await n.getItem("byblos-fetchUrl").then(s=>{var f,_;return(_=(f=s==null?void 0:s.at(-1))==null?void 0:f.fetchUrl)==null?void 0:_.split("?q=")})||"",c=`${o}?q=${u}&startIndex=${r}&maxResults=40${I}`,{data:m}=await D.get(c);y||(m.items&&((b=e==null?void 0:e.items)==null||b.push(...m==null?void 0:m.items),q({type:U,payload:{responseState:{fetchUrl:p,startIndex:r,searchTerm:i,searchResults:{...m,items:e==null?void 0:e.items},selectedVolume:a,selectedAuthor:g,selectedPublisher:F,bookshelfVolumes:j}}})),(r>600||!m.items)&&P(!1))}catch(i){const o=new Error(i,{cause:"fetchMoreResults()"});console.group("Error in authorCollection useEffect"),console.error("name: ",o.name),console.error("message: ",o.message),console.error("cause: ",o.cause),console.groupCollapsed("stack trace"),console.trace(o),console.error("detailed stack trace",o.stack),console.groupEnd()}})(),()=>{y=!0}},[$]);const z=e&&S?E(k,{align:"center",justify:"center",children:[t(G,{size:"sm"}),t(x,{w:"xs"}),t(M,{children:"Fetching more results..."})]}):t(k,{align:"center",justify:"center",children:t(M,{children:"No more results"})});return E(h.Fragment,{children:[t(k,{justify:"center",children:t(H,{order:3,color:W==="light"?"dark.5":"gray.5",children:"Author collection"})}),t(x,{h:"md"}),t(J,{fallback:t(K,{componentName:"Author Collection"}),children:E(h.Suspense,{fallback:t(O,{componentName:"Author Collection"}),children:[t(X,{allStates:C,allActions:w,allDispatches:A}),t("div",{ref:S?N:null,children:z}),Array.from({length:5}).map((y,l)=>t(x,{h:"xl"},l))]})})]})}export{ie as default};
