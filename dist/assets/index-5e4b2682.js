import{R as z,_ as W,r as f,u as B,j as k,F as x,a as e,L as G,S as w,T as U,f as H,E as V,b as J,M as K,c as C,i as Q,e as X,l as i}from"./index-031fa283.js";import{u as Y}from"./react-intersection-observer.esm-274d9d73.js";const Z=z.lazy(()=>W(()=>import("./index-1e643e4a.js"),["assets/index-1e643e4a.js","assets/index-031fa283.js","assets/index.esm-c48e3429.js","assets/index.esm-65c92dff.js","assets/index-d87e9139.js","assets/Popover-411edea3.js","assets/use-reduced-motion-017d389a.js","assets/get-default-z-index-b47c3510.js","assets/Card-06514448.js","assets/CloseButton-eab6b835.js","assets/index.esm-2ae87725.js"]));function te({allStates:_,allActions:T,allDispatches:O}){const[p,D]=f.useState([]),[S,L]=f.useState(!0);B();const{ref:M,inView:$}=Y({threshold:0});let{responseState:{fetchUrl:E,startIndex:g,searchTerm:m,searchResults:r,selectedVolume:a,selectedAuthor:y,selectedPublisher:R,bookshelfVolumes:j},themeState:{theme:A}}=_,{responseDispatch:q}=O,{responseActions:{setAll:F}}=T;f.useEffect(()=>{(async()=>{try{const[l,s]=E.split("q="),c=`${l}q=${(a==null?void 0:a.volumeInfo.title)||p[0].volumeInfo.title}+inauthor:${y||p[0].volumeInfo.authors[0]}&maxResults=40${s}`,{data:o}=await C.get(c);let d=Q(o.items??[]);d=X(d),g=0,m=`${(a==null?void 0:a.volumeInfo.title)??p[0].volumeInfo.title}+inauthor:${y??p[0].volumeInfo.authors[0]}`,r=o;try{await i.setItem("byblos-startIndex",g),await i.setItem("byblos-searchTerm",m),await i.setItem("byblos-searchResults",r)}catch(b){const n=new Error(b,{cause:"inner try block inside fetchOtherEditions()"});console.group("Error in otherEditions useEffect"),console.error("name: ",n.name),console.error("message: ",n.message),console.error("cause: ",n.cause),console.groupCollapsed("stack trace"),console.trace(n),console.error("detailed stack trace",n.stack),console.groupEnd()}finally{q({type:F,payload:{responseState:{fetchUrl:E,startIndex:g,searchTerm:m,searchResults:r,selectedVolume:a,selectedAuthor:y,selectedPublisher:R,bookshelfVolumes:j}}}),D(d)}}catch(l){const s=new Error(l,{cause:"outer try block inside fetchOtherEditions()"});console.group("Error in otherEditions useEffect"),console.error("name: ",s.name),console.error("message: ",s.message),console.error("cause: ",s.cause),console.groupCollapsed("stack trace"),console.trace(s),console.error("detailed stack trace",s.stack),console.groupEnd()}})()},[]),f.useEffect(()=>{let I=!1;return $&&(async()=>{var s;try{const c=g+40,o=m||await i.getItem("byblos-searchTerm")||await i.getItem("byblos-searchTerm").then(t=>{var u;return(u=t==null?void 0:t.at(-1))==null?void 0:u.searchTerm})||"",[d,b]=E.split("?q=")||await i.getItem("byblos-fetchUrl").then(t=>t==null?void 0:t.split("?q="))||await i.getItem("byblos-fetchUrl").then(t=>{var u,P;return(P=(u=t==null?void 0:t.at(-1))==null?void 0:u.fetchUrl)==null?void 0:P.split("?q=")})||"",n=`${d}?q=${m}&startIndex=${c}&maxResults=40${b}`,{data:h}=await C.get(n);I||(h.items&&((s=r==null?void 0:r.items)==null||s.push(...h==null?void 0:h.items),q({type:F,payload:{responseState:{fetchUrl:E,startIndex:c,searchTerm:o,searchResults:{...h,items:r==null?void 0:r.items},selectedVolume:a,selectedAuthor:y,selectedPublisher:R,bookshelfVolumes:j}}})),(c>600||!h.items)&&L(!1))}catch(c){const o=new Error(c,{cause:"fetchMoreResults()"});console.group("Error in otherEditions useEffect"),console.error("name: ",o.name),console.error("message: ",o.message),console.error("cause: ",o.cause),console.groupCollapsed("stack trace"),console.trace(o),console.error("detailed stack trace",o.stack),console.groupEnd()}})(),()=>{I=!0}},[$]);const N=r&&S?k(x,{align:"center",justify:"center",children:[e(G,{size:"sm"}),e(w,{w:"xs"}),e(U,{children:"Fetching more results..."})]}):e(x,{align:"center",justify:"center",children:e(U,{children:"No more results"})});return k("div",{children:[e(x,{justify:"center",children:e(H,{order:3,color:A==="light"?"dark.5":"gray.5",children:"Other editions"})}),e(w,{h:"md"}),e(V,{fallback:e(J,{componentName:"Other Editions"}),children:k(f.Suspense,{fallback:e(K,{componentName:"Other Editions"}),children:[e(Z,{allStates:_,allActions:T,allDispatches:O}),e("div",{ref:S?M:null,children:N}),Array.from({length:5}).map((I,l)=>e(w,{h:"xl"},l))]})})]})}export{te as default};
