import{r as w,d as V,u as ee,i as R,l as d,v as re,j as m,a as o,F as p,T as g,S as A,G as S,I as oe,e as se,L as ae,B as y,t as te}from"./index-064c6a11.js";import{B as ne}from"./index.esm-008f09fb.js";import{M as ie,a as ce,b as le,c as de,H as ue}from"./index.esm-6f373bf9.js";import{d as he,M as ge,C as me,a as fe,I as pe,b as ke,S as we}from"./index-63689533.js";import{C as F}from"./Card-5f2de60e.js";import{P as T}from"./Popover-77682786.js";import"./get-default-z-index-b47c3510.js";import"./CloseButton-a48066d3.js";import"./use-reduced-motion-36c0a9c9.js";import"./index.esm-348e47db.js";function Se({allStates:j,allActions:O,allDispatches:_}){const[H,N]=w.useState([]),[n,k]=w.useState([]),[G,z]=w.useState(!1),[P,U]=w.useState(""),[Y,W]=w.useState(""),{width:c=0}=V();ee();let{responseState:{fetchUrl:D,startIndex:v,searchTerm:I,searchResults:b,selectedVolume:E,selectedAuthor:x,selectedPublisher:C,bookshelfVolumes:L},themeState:{theme:f},navlinksState:Z}=j,{responseDispatch:$,navlinksDispatch:q}=_,{responseActions:{setAll:J},navlinksActions:K}=O;const M=R((b==null?void 0:b.items)??H),Q={navlinksState:Z,navlinksActions:K,navlinksDispatch:q};async function B(a,t,h,l){const s=structuredClone(h);switch(a){case"rating":{const i=s.find(e=>e.id===t.id),u=s.findIndex(e=>e.id===t.id);if(i){i.rating=l,s.splice(u,1,i),k(s);try{await d.setItem("byblos-userBookshelf",s)}catch(e){const r=new Error(e,{cause:"switch case 'rating', in if block"});console.group("Error in setting userBookshelf: switch case 'rating', in localforage"),console.error("name: ",r.name),console.error("message: ",r.message),console.error("cause: ",r.cause),console.groupCollapsed("stack trace"),console.trace(r),console.error("detailed stack trace",r.stack),console.groupEnd()}}else{s.push({name:t.volumeInfo.title,id:t.id,volume:t,rating:l,markRead:!1,favourite:!1,readLater:!1,dateAdded:new Date}),k(s);try{await d.setItem("byblos-userBookshelf",s)}catch(e){const r=new Error(e,{cause:"switch case 'rating', in else block"});console.group("Error in setting userBookshelf: switch case 'rating', in localforage"),console.error("name: ",r.name),console.error("message: ",r.message),console.error("cause: ",r.cause),console.groupCollapsed("stack trace"),console.trace(r),console.error("detailed stack trace",r.stack),console.groupEnd()}}break}case"markRead":{const i=s.find(e=>e.id===t.id),u=s.findIndex(e=>e.id===t.id);if(i){i.markRead=!l,s.splice(u,1,i),k(s);try{await d.setItem("byblos-userBookshelf",s)}catch(e){const r=new Error(e,{cause:"switch case 'markRead', in if block"});console.group("Error in setting userBookshelf: switch case 'markRead', in localforage"),console.error("name: ",r.name),console.error("message: ",r.message),console.error("cause: ",r.cause),console.groupCollapsed("stack trace"),console.trace(r),console.error("detailed stack trace",r.stack),console.groupEnd()}}else{s.push({name:t.volumeInfo.title,id:t.id,volume:t,rating:0,markRead:!l,favourite:!1,readLater:!1,dateAdded:new Date}),k(s);try{await d.setItem("byblos-userBookshelf",s)}catch(e){const r=new Error(e,{cause:"switch case 'markRead', in else block"});console.group("Error in setting userBookshelf: switch case 'markRead', in localforage"),console.error("name: ",r.name),console.error("message: ",r.message),console.error("cause: ",r.cause),console.groupCollapsed("stack trace"),console.trace(r),console.error("detailed stack trace",r.stack),console.groupEnd()}}break}case"favourite":{const i=s.find(e=>e.id===t.id),u=s.findIndex(e=>e.id===t.id);if(i){i.favourite=!l,s.splice(u,1,i),k(s);try{await d.setItem("byblos-userBookshelf",s)}catch(e){const r=new Error(e,{cause:"switch case 'favourite', in if block"});console.group("Error in setting userBookshelf: switch case 'favourite', in localforage"),console.error("name: ",r.name),console.error("message: ",r.message),console.error("cause: ",r.cause),console.groupCollapsed("stack trace"),console.trace(r),console.error("detailed stack trace",r.stack),console.groupEnd()}}else{s.push({name:t.volumeInfo.title,id:t.id,volume:t,rating:0,markRead:!1,favourite:!l,readLater:!1,dateAdded:new Date}),k(s);try{await d.setItem("byblos-userBookshelf",s)}catch(e){const r=new Error(e,{cause:"switch case 'favourite', in else block"});console.group("Error in setting userBookshelf: switch case 'favourite', in localforage"),console.error("name: ",r.name),console.error("message: ",r.message),console.error("cause: ",r.cause),console.groupCollapsed("stack trace"),console.trace(r),console.error("detailed stack trace",r.stack),console.groupEnd()}}break}case"readLater":{const i=s.find(e=>e.id===t.id),u=s.findIndex(e=>e.id===t.id);if(i){i.readLater=!l,s.splice(u,1,i),k(s);try{await d.setItem("byblos-userBookshelf",s)}catch(e){const r=new Error(e,{cause:"switch case 'readLater', in if block"});console.group("Error in setting userBookshelf: switch case 'readLater', in localforage"),console.error("name: ",r.name),console.error("message: ",r.message),console.error("cause: ",r.cause),console.groupCollapsed("stack trace"),console.trace(r),console.error("detailed stack trace",r.stack),console.groupEnd()}}else{s.push({name:t.volumeInfo.title,id:t.id,volume:t,rating:0,markRead:!1,favourite:!1,readLater:!l,dateAdded:new Date}),k(s);try{await d.setItem("byblos-userBookshelf",s)}catch(e){const r=new Error(e,{cause:"switch case 'readLater', in else block"});console.group("Error in setting userBookshelf: switch case 'readLater', in localforage"),console.error("name: ",r.name),console.error("message: ",r.message),console.error("cause: ",r.cause),console.groupCollapsed("stack trace"),console.trace(r),console.error("detailed stack trace",r.stack),console.groupEnd()}}break}case"removeVolume":{const i=s.find(e=>e.id===t.id),u=s.findIndex(e=>e.id===t.id);if(i){s.splice(u,1),k(s);try{await d.setItem("byblos-userBookshelf",s)}catch(e){const r=new Error(e,{cause:"switch case 'removeVolume', in if block"});console.group("Error in setting userBookshelf: switch case 'removeVolume', in localforage"),console.error("name: ",r.name),console.error("message: ",r.message),console.error("cause: ",r.cause),console.groupCollapsed("stack trace"),console.trace(r),console.error("detailed stack trace",r.stack),console.groupEnd()}}break}}}w.useEffect(()=>{(async()=>{try{const t=await d.getItem("byblos-searchResults");t&&N(R((t==null?void 0:t.items)??[]))}catch(t){const h=new Error(t,{cause:"fetchLocalStorageFallback()"});console.group("Error in displayGeneric useEffect"),console.error("name: ",h.name),console.error("message: ",h.message),console.error("cause: ",h.cause),console.groupCollapsed("stack trace"),console.trace(h),console.error("detailed stack trace",h.stack),console.groupEnd()}})()},[]);async function X(a,t){var i;let{navlinksState:h,navlinksActions:l,navlinksDispatch:s}=t;te(h,l,s),v=0,I=a.volumeInfo.title,E=a,x=((i=a.volumeInfo.authors)==null?void 0:i.join(","))??"",C=a.volumeInfo.publisher??"";try{await d.setItem("byblos-startIndex",v),await d.setItem("byblos-searchTerm",I),await d.setItem("byblos-selectedVolume",E),await d.setItem("byblos-selectedAuthor",x),await d.setItem("byblos-selectedPublisher",C);const u=await d.getItem("byblos-historyState")??[{fetchUrl:D,startIndex:v,searchTerm:I,searchResults:b,selectedVolume:E,selectedAuthor:x,selectedPublisher:C,bookshelfVolumes:L}];u.push({fetchUrl:D,startIndex:v,searchTerm:I,searchResults:b,selectedVolume:E,selectedAuthor:x,selectedPublisher:C,bookshelfVolumes:L}),await d.setItem("byblos-historyState",u)}catch(u){const e=new Error(u,{cause:"handleTitleClick()"});console.group("Error in displayGeneric eventHandler"),console.error("name: ",e.name),console.error("message: ",e.message),console.error("cause: ",e.cause),console.groupCollapsed("stack trace"),console.trace(e),console.error("detailed stack trace",e.stack),console.groupEnd()}finally{$({type:J,payload:{responseState:{fetchUrl:D,startIndex:v,searchTerm:I,searchResults:b,selectedVolume:E,selectedAuthor:x,selectedPublisher:C,bookshelfVolumes:L}}}),window.scrollTo(0,0)}}return w.useEffect(()=>{(async function(){let t=[];try{t=await d.getItem("byblos-userBookshelf").then(h=>h??[{name:"Mirror Dance",id:re(),volume:he,rating:5,markRead:!0,favourite:!0,readLater:!0,dateAdded:new Date}])}catch(h){const l=new Error(h,{cause:"generateUserBookshelf()"});console.group("Error in displayGeneric useEffect"),console.error("name: ",l.name),console.error("message: ",l.message),console.error("cause: ",l.cause),console.groupCollapsed("stack trace"),console.trace(l),console.error("detailed stack trace",l.stack),console.groupEnd()}return t})().then(a=>{k(a)})},[]),m(w.Fragment,{children:[o(ge,{modalOpened:G,setModalOpened:z,src:P,alt:Y}),m(p,{gap:"xl",direction:"column",children:[M.length===0?o(me,{children:o(F,{shadow:"sm",p:"md",radius:"md",withBorder:!0,children:m(p,{direction:"column",align:"center",justify:"center",children:[o(g,{color:f==="light"?"dark.5":"gray.5",children:"There seems to be nothing here."}),o(A,{h:"md"}),o(g,{color:f==="light"?"dark.5":"gray.5",size:28,children:"(｡•́︿•̀｡)"})]})})}):null,M.map(a=>{var t,h,l,s,i,u;return a.id==="aZ0YkIU0HusC"?null:o(F,{shadow:"sm",p:c<576?"xs":"md",radius:"md",withBorder:!0,style:{minHeight:"325px"},children:m(S,{columns:9,children:[o(S.Col,{span:c<992?2:1,children:o(p,{style:{width:"100%",height:"100%",minWidth:"50px"},direction:"column",justify:"center",align:"center",children:o(oe,{style:{cursor:"pointer"},src:(t=a.volumeInfo.imageLinks)==null?void 0:t.thumbnail,alt:"",onClick:()=>{var e;U(((e=a.volumeInfo.imageLinks)==null?void 0:e.thumbnail)??""),W(a.volumeInfo.title),z(!0)},withPlaceholder:!0,placeholder:o(g,{align:"center",children:"No image available"}),radius:"xs","data-cy":"image-thumbnail"})})}),m(S.Col,{span:c<992?7:8,children:[m(p,{align:"center",justify:"space-between",children:[o(se,{order:2,onClick:()=>{X(a,Q)},"data-cy":"title-volume",style:{paddingBottom:"3px"},color:f==="light"?"dark.5":"gray.4",children:o(ae,{to:`/home/displayVolume/${a.customId}`,style:{textDecoration:"none",color:"inherit"},children:a.volumeInfo.title})}),o(p,{children:m(T,{width:300,position:c<576?"bottom":"left",withArrow:!0,shadow:"xl",radius:"md",children:[o(T.Target,{children:o(y,{variant:c<576?"light":"subtle",radius:"lg","data-cy":"dropdownIcon-volume",children:o(ne,{size:20})})}),o(T.Dropdown,{children:m(p,{direction:"column",justify:"center",align:"center",gap:"sm","data-cy":"dropdownMenu-volume",children:[m(p,{direction:"row",align:"center",justify:"space-between",style:{width:"100%"},children:[o(g,{size:c<576?"sm":"md",color:f==="light"?"dark.5":"gray.5","data-cy":"rate-dropDownMenu",children:"Rate"}),o(fe,{value:((h=n==null?void 0:n.find(e=>e.id===a.id))==null?void 0:h.rating)??0,onChange:e=>B("rating",a,n,e)})]}),m(p,{direction:"row",align:"center",justify:"space-between",style:{width:"100%"},children:[o(g,{size:c<576?"sm":"md",color:f==="light"?"dark.5":"gray.5","data-cy":"favourite-dropDownMenu",children:"Favourite"}),o(y,{variant:c<576?"light":"subtle",radius:"lg",onClick:()=>{var e;B("favourite",a,n,((e=n.find(r=>r.id===a.id))==null?void 0:e.favourite)??!1)},children:(l=n==null?void 0:n.find(e=>e.id===a.id))!=null&&l.favourite?o(ie,{size:20}):o(ce,{size:20})})]}),m(p,{direction:"row",align:"center",justify:"space-between",style:{width:"100%"},children:[o(g,{size:c<576?"sm":"md",color:f==="light"?"dark.5":"gray.5","data-cy":"readLater-dropDownMenu",children:"Read later"}),o(y,{variant:c<576?"light":"subtle",radius:"lg",onClick:()=>{var e;B("readLater",a,n,((e=n.find(r=>r.id===a.id))==null?void 0:e.readLater)??!1)},children:(s=n==null?void 0:n.find(e=>e.id===a.id))!=null&&s.readLater?o(le,{size:20}):o(de,{size:20})})]}),m(p,{direction:"row",align:"center",justify:"space-between",style:{width:"100%"},children:[o(g,{size:c<576?"sm":"md",color:f==="light"?"dark.5":"gray.5","data-cy":"markRead-dropDownMenu",children:"Mark read"}),o(y,{variant:c<576?"light":"subtle",radius:"lg",onClick:()=>{var e;B("markRead",a,n,((e=n.find(r=>r.id===a.id))==null?void 0:e.markRead)??!1)},children:(i=n==null?void 0:n.find(e=>e.id===a.id))!=null&&i.markRead?o(pe,{size:20}):o(ke,{size:20})})]}),m(p,{direction:"row",align:"center",justify:"space-between",style:{width:"100%"},children:[o(g,{size:c<576?"sm":"md",color:f==="light"?"dark.5":"gray.5","data-cy":"remove-dropDownMenu",children:"Remove"}),o(y,{variant:c<576?"light":"subtle",radius:"lg",disabled:!(n!=null&&n.some(e=>e.id===a.id)),onClick:()=>{B("removeVolume",a,n,!0)},children:o(ue,{size:20})})]})]})})]})})]}),(u=a.volumeInfo.authors)==null?void 0:u.join(",:").split(":").map(e=>m(g,{style:{display:"inline"},color:f==="light"?"dark.5":"gray.4","data-cy":"author-volume",size:c<576?"lg":"xl",children:[e," "]},e)),o(g,{style:{paddingTop:"3px",paddingBottom:"3px"},color:f==="light"?"dark.5":"gray.5","data-cy":"publishedYear-volume",size:"md",children:Number.isNaN(new Date(a.volumeInfo.publishedDate).getFullYear().toString())||new Date(a.volumeInfo.publishedDate).getFullYear().toString()==="NaN"?"Date unavailable":new Date(a.volumeInfo.publishedDate).getFullYear()}),o(we,{maxHeight:c<576?174:178,"data-cy":"spoiler-volume",showLabel:c<576?o(y,{radius:"md",variant:"light",children:o(g,{size:c<576?"sm":"md",children:"⬇ Show more"})}):o(g,{size:c<576?"sm":"md",weight:"bold",children:"⬇ Show more"}),hideLabel:c<576?o(y,{radius:"md",variant:"light",children:o(g,{size:c<576?"sm":"md",children:"⬆ Hide"})}):o(g,{size:c<576?"sm":"md",weight:"bold",children:"⬆ Hide"}),transitionDuration:382,children:o(g,{color:f==="light"?"dark.5":"gray.5","data-cy":"description-volume",size:"md",children:a.volumeInfo.description??"Description unavailable"})})]})]},a.customId)},a.customId)})]}),o(A,{h:"xl"})]})}export{Se as default};
