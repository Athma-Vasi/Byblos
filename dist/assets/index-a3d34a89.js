import{R as D,_ as N,r as u,u as L,j as q,a as o,F as W,e as z,S as P,E as B,b as G,M as V,c as U,i as H,l as i}from"./index-064c6a11.js";import{u as J}from"./react-intersection-observer.esm-299e8c76.js";const K=D.lazy(()=>N(()=>import("./index-5d3916a2.js"),["assets/index-5d3916a2.js","assets/index-064c6a11.js","assets/index.esm-008f09fb.js","assets/index.esm-6f373bf9.js","assets/index-63689533.js","assets/Popover-77682786.js","assets/use-reduced-motion-36c0a9c9.js","assets/get-default-z-index-b47c3510.js","assets/Card-5f2de60e.js","assets/CloseButton-a48066d3.js","assets/index.esm-348e47db.js"]));function Y({allStates:k,allActions:w,allDispatches:x}){const[f,C]=u.useState([]),[F,M]=u.useState(!0);L();const{ref:j,inView:_}=J({threshold:0});let{responseState:{fetchUrl:p,startIndex:E,searchTerm:m,searchResults:s,selectedVolume:a,selectedAuthor:g,selectedPublisher:O,bookshelfVolumes:$},themeState:{theme:A}}=k,{responseDispatch:S}=x,{responseActions:{setAll:T}}=w;return u.useEffect(()=>{(async()=>{try{const[l,t]=p.split("q="),c=`${l}q=${(a==null?void 0:a.volumeInfo.title)||f[0].volumeInfo.title}+inauthor:${g||f[0].volumeInfo.authors[0]}&maxResults=40${t}`,{data:r}=await U.get(c),I=H(r.items??[]);E=0,m=`${(a==null?void 0:a.volumeInfo.title)??f[0].volumeInfo.title}+inauthor:${g??f[0].volumeInfo.authors[0]}`,s=r;try{await i.setItem("byblos-startIndex",E),await i.setItem("byblos-searchTerm",m),await i.setItem("byblos-searchResults",s)}catch(b){const n=new Error(b,{cause:"inner try block inside fetchOtherEditions()"});console.group("Error in otherEditions useEffect"),console.error("name: ",n.name),console.error("message: ",n.message),console.error("cause: ",n.cause),console.groupCollapsed("stack trace"),console.trace(n),console.error("detailed stack trace",n.stack),console.groupEnd()}finally{S({type:T,payload:{responseState:{fetchUrl:p,startIndex:E,searchTerm:m,searchResults:s,selectedVolume:a,selectedAuthor:g,selectedPublisher:O,bookshelfVolumes:$}}}),C(I)}}catch(l){const t=new Error(l,{cause:"outer try block inside fetchOtherEditions()"});console.group("Error in otherEditions useEffect"),console.error("name: ",t.name),console.error("message: ",t.message),console.error("cause: ",t.cause),console.groupCollapsed("stack trace"),console.trace(t),console.error("detailed stack trace",t.stack),console.groupEnd()}})()},[]),u.useEffect(()=>{let y=!1;return _&&(async()=>{var t;try{const c=E+40,r=m||await i.getItem("byblos-searchTerm")||await i.getItem("byblos-searchTerm").then(e=>{var d;return(d=e==null?void 0:e.at(-1))==null?void 0:d.searchTerm})||"",[I,b]=p.split("?q=")||await i.getItem("byblos-fetchUrl").then(e=>e==null?void 0:e.split("?q="))||await i.getItem("byblos-fetchUrl").then(e=>{var d,R;return(R=(d=e==null?void 0:e.at(-1))==null?void 0:d.fetchUrl)==null?void 0:R.split("?q=")})||"",n=`${I}?q=${m}&startIndex=${c}&maxResults=40${b}`,{data:h}=await U.get(n);y||(h.items&&((t=s==null?void 0:s.items)==null||t.push(...h==null?void 0:h.items),S({type:T,payload:{responseState:{fetchUrl:p,startIndex:c,searchTerm:r,searchResults:{...h,items:s==null?void 0:s.items},selectedVolume:a,selectedAuthor:g,selectedPublisher:O,bookshelfVolumes:$}}})),(c>600||!h.items)&&M(!1))}catch(c){const r=new Error(c,{cause:"fetchMoreResults()"});console.group("Error in otherEditions useEffect"),console.error("name: ",r.name),console.error("message: ",r.message),console.error("cause: ",r.cause),console.groupCollapsed("stack trace"),console.trace(r),console.error("detailed stack trace",r.stack),console.groupEnd()}})(),()=>{y=!0}},[_]),q("div",{children:[o(W,{justify:"center",children:o(z,{order:3,color:A==="light"?"dark.5":"gray.5",children:"Other editions"})}),o(P,{h:"md"}),o(B,{fallback:o(G,{componentName:"Other Editions"}),children:q(u.Suspense,{fallback:o(V,{componentName:"Other Editions"}),children:[o(K,{allStates:k,allActions:w,allDispatches:x}),o("div",{ref:F?j:null}),Array.from({length:5}).map((y,l)=>o(P,{h:"xl"},l))]})})]})}export{Y as default};
