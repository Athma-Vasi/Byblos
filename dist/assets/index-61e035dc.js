import{r as h,u as B,j as k,F as x,a as s,L as G,S as w,T as M,f as H,E as J,b as K,M as O,c as D,i as Q,e as R,l as n}from"./index-031fa283.js";import{u as V}from"./react-intersection-observer.esm-274d9d73.js";import X from"./index-1e643e4a.js";import"./index.esm-c48e3429.js";import"./index.esm-65c92dff.js";import"./index-d87e9139.js";import"./Popover-411edea3.js";import"./use-reduced-motion-017d389a.js";import"./get-default-z-index-b47c3510.js";import"./Card-06514448.js";import"./CloseButton-eab6b835.js";import"./index.esm-2ae87725.js";function ie({allStates:P,allActions:C,allDispatches:T}){const[S,L]=h.useState([]),[$,A]=h.useState(!0);B();const{ref:N,inView:F}=V({threshold:0});let{responseState:{fetchUrl:f,startIndex:b,searchTerm:u,searchResults:e,selectedVolume:r,selectedAuthor:d,selectedPublisher:g,bookshelfVolumes:j},themeState:{theme:W}}=P;const{responseDispatch:q}=T;let{responseActions:{setAll:U}}=C;h.useEffect(()=>{(async()=>{try{const[l,t]=f.split("q="),I=`${l}q=${d||(r==null?void 0:r.volumeInfo.authors)}+inpublisher:${g||(r==null?void 0:r.volumeInfo.publisher)||S[0].volumeInfo.publisher||(e==null?void 0:e.items[0].volumeInfo.publisher)||""}&maxResults=40${t}`,{data:i}=await D.get(I);let o=Q(i.items??[]);o=R(o),b=0,u=`${d||(r==null?void 0:r.volumeInfo.authors)}+inpublisher:${g||(r==null?void 0:r.volumeInfo.publisher)||S[0].volumeInfo.publisher||(e==null?void 0:e.items[0].volumeInfo.publisher)||""}`,e=i;try{await n.setItem("byblos-startIndex",b),await n.setItem("byblos-searchTerm",u),await n.setItem("byblos-searchResults",e)}catch(E){const c=new Error(E,{cause:"inner try block inside fetchPublisherVolumes()"});console.group("Error in publisherCollection useEffect"),console.error("name: ",c.name),console.error("message: ",c.message),console.error("cause: ",c.cause),console.groupCollapsed("stack trace"),console.trace(c),console.error("detailed stack trace",c.stack),console.groupEnd()}finally{q({type:U,payload:{responseState:{fetchUrl:f,startIndex:b,searchTerm:u,searchResults:e,selectedVolume:r,selectedAuthor:d,selectedPublisher:g,bookshelfVolumes:j}}}),L(o)}}catch(l){const t=new Error(l,{cause:"outer try block inside fetchPublisherVolumes()"});console.group("Error in publisherCollection useEffect"),console.error("name: ",t.name),console.error("message: ",t.message),console.error("cause: ",t.cause),console.groupCollapsed("stack trace"),console.trace(t),console.error("detailed stack trace",t.stack),console.groupEnd()}})()},[]),h.useEffect(()=>{let y=!1;return F&&(async()=>{var I;const t=b+40;try{const i=u||await n.getItem("byblos-searchTerm")||await n.getItem("byblos-searchTerm").then(a=>{var p;return(p=a==null?void 0:a.at(-1))==null?void 0:p.searchTerm})||"",[o,E]=f.split("?q=")||await n.getItem("byblos-fetchUrl").then(a=>a==null?void 0:a.split("?q="))||await n.getItem("byblos-fetchUrl").then(a=>{var p,_;return(_=(p=a==null?void 0:a.at(-1))==null?void 0:p.fetchUrl)==null?void 0:_.split("?q=")})||"",c=`${o}?q=${u}&startIndex=${t}&maxResults=40${E}`,{data:m}=await D.get(c);y||(m.items&&((I=e==null?void 0:e.items)==null||I.push(...m==null?void 0:m.items),q({type:U,payload:{responseState:{fetchUrl:f,startIndex:t,searchTerm:i,searchResults:{...m,items:e==null?void 0:e.items},selectedVolume:r,selectedAuthor:d,selectedPublisher:g,bookshelfVolumes:j}}})),(t>600||!m.items)&&A(!1))}catch(i){const o=new Error(i,{cause:"fetchMoreResults()"});console.group("Error in publisherCollection useEffect"),console.error("name: ",o.name),console.error("message: ",o.message),console.error("cause: ",o.cause),console.groupCollapsed("stack trace"),console.trace(o),console.error("detailed stack trace",o.stack),console.groupEnd()}})(),()=>{y=!0}},[F]);const z=e&&$?k(x,{align:"center",justify:"center",children:[s(G,{size:"sm"}),s(w,{w:"xs"}),s(M,{children:"Fetching more results..."})]}):s(x,{align:"center",justify:"center",children:s(M,{children:"No more results"})});return k(h.Fragment,{children:[s(x,{justify:"center",children:s(H,{order:3,color:W==="light"?"dark.5":"gray.5",children:"Publisher collection"})}),s(w,{h:"md"}),s(J,{fallback:s(K,{componentName:"Publisher Collection"}),children:k(h.Suspense,{fallback:s(O,{componentName:"Publisher Collection"}),children:[s(X,{allStates:P,allActions:C,allDispatches:T}),s("div",{ref:$?N:null,children:z}),Array.from({length:5}).map((y,l)=>s(w,{h:"xl"},l))]})})]})}export{ie as default};
