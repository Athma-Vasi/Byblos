import{r as h,u as W,j as F,a,F as B,e as G,S as U,E as L,b as z,M as H,c as _,i as J,l as n}from"./index-064c6a11.js";import{u as K}from"./react-intersection-observer.esm-299e8c76.js";import O from"./index-5d3916a2.js";import"./index.esm-008f09fb.js";import"./index.esm-6f373bf9.js";import"./index-63689533.js";import"./Popover-77682786.js";import"./use-reduced-motion-36c0a9c9.js";import"./get-default-z-index-b47c3510.js";import"./Card-5f2de60e.js";import"./CloseButton-a48066d3.js";import"./index.esm-348e47db.js";function ae({allStates:k,allActions:w,allDispatches:x}){const[P,M]=h.useState([]),[j,A]=h.useState(!0);W();const{ref:D,inView:C}=K({threshold:0});let{responseState:{fetchUrl:f,startIndex:b,searchTerm:u,searchResults:e,selectedVolume:r,selectedAuthor:d,selectedPublisher:g,bookshelfVolumes:$},themeState:{theme:N}}=k;const{responseDispatch:S}=x;let{responseActions:{setAll:T}}=w;return h.useEffect(()=>{(async()=>{try{const[l,o]=f.split("q="),I=`${l}q=${d||(r==null?void 0:r.volumeInfo.authors)}+inpublisher:${g||(r==null?void 0:r.volumeInfo.publisher)||P[0].volumeInfo.publisher||(e==null?void 0:e.items[0].volumeInfo.publisher)||""}&maxResults=40${o}`,{data:i}=await _.get(I),t=J(i.items??[]);b=0,u=`${d||(r==null?void 0:r.volumeInfo.authors)}+inpublisher:${g||(r==null?void 0:r.volumeInfo.publisher)||P[0].volumeInfo.publisher||(e==null?void 0:e.items[0].volumeInfo.publisher)||""}`,e=i;try{await n.setItem("byblos-startIndex",b),await n.setItem("byblos-searchTerm",u),await n.setItem("byblos-searchResults",e)}catch(E){const c=new Error(E,{cause:"inner try block inside fetchPublisherVolumes()"});console.group("Error in publisherCollection useEffect"),console.error("name: ",c.name),console.error("message: ",c.message),console.error("cause: ",c.cause),console.groupCollapsed("stack trace"),console.trace(c),console.error("detailed stack trace",c.stack),console.groupEnd()}finally{S({type:T,payload:{responseState:{fetchUrl:f,startIndex:b,searchTerm:u,searchResults:e,selectedVolume:r,selectedAuthor:d,selectedPublisher:g,bookshelfVolumes:$}}}),M(t)}}catch(l){const o=new Error(l,{cause:"outer try block inside fetchPublisherVolumes()"});console.group("Error in publisherCollection useEffect"),console.error("name: ",o.name),console.error("message: ",o.message),console.error("cause: ",o.cause),console.groupCollapsed("stack trace"),console.trace(o),console.error("detailed stack trace",o.stack),console.groupEnd()}})()},[]),h.useEffect(()=>{let y=!1;return C&&(async()=>{var I;const o=b+40;try{const i=u||await n.getItem("byblos-searchTerm")||await n.getItem("byblos-searchTerm").then(s=>{var p;return(p=s==null?void 0:s.at(-1))==null?void 0:p.searchTerm})||"",[t,E]=f.split("?q=")||await n.getItem("byblos-fetchUrl").then(s=>s==null?void 0:s.split("?q="))||await n.getItem("byblos-fetchUrl").then(s=>{var p,q;return(q=(p=s==null?void 0:s.at(-1))==null?void 0:p.fetchUrl)==null?void 0:q.split("?q=")})||"",c=`${t}?q=${u}&startIndex=${o}&maxResults=40${E}`,{data:m}=await _.get(c);y||(m.items&&((I=e==null?void 0:e.items)==null||I.push(...m==null?void 0:m.items),S({type:T,payload:{responseState:{fetchUrl:f,startIndex:o,searchTerm:i,searchResults:{...m,items:e==null?void 0:e.items},selectedVolume:r,selectedAuthor:d,selectedPublisher:g,bookshelfVolumes:$}}})),(o>600||!m.items)&&A(!1))}catch(i){const t=new Error(i,{cause:"fetchMoreResults()"});console.group("Error in publisherCollection useEffect"),console.error("name: ",t.name),console.error("message: ",t.message),console.error("cause: ",t.cause),console.groupCollapsed("stack trace"),console.trace(t),console.error("detailed stack trace",t.stack),console.groupEnd()}})(),()=>{y=!0}},[C]),F(h.Fragment,{children:[a(B,{justify:"center",children:a(G,{order:3,color:N==="light"?"dark.5":"gray.5",children:"Publisher collection"})}),a(U,{h:"md"}),a(L,{fallback:a(z,{componentName:"Publisher Collection"}),children:F(h.Suspense,{fallback:a(H,{componentName:"Publisher Collection"}),children:[a(O,{allStates:k,allActions:w,allDispatches:x}),a("div",{ref:j?D:null}),Array.from({length:5}).map((y,l)=>a(U,{h:"xl"},l))]})})]})}export{ae as default};
